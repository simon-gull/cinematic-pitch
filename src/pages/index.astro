---
import fs from 'node:fs'
import path from 'node:path'
import yaml from 'js-yaml'
import Layout from '../layouts/Layout.astro'

const contentDir = path.join(process.cwd(), 'src', 'content')
const files = fs.readdirSync(contentDir).filter(f => f.endsWith('.yaml') || f.endsWith('.yml'))

const projects = files.map(file => {
  const raw = fs.readFileSync(path.join(contentDir, file), 'utf-8')
  const data = yaml.load(raw) as any
  return data
}).sort((a, b) => (b.year || 0) - (a.year || 0))
---

<Layout title="Dig Deeper Films">
  <main class="min-h-screen flex flex-col items-center justify-center px-6 md:px-16" style="background: #0A0A0A;">
    <div class="max-w-4xl w-full py-24">
      <h1 class="font-display text-3xl md:text-5xl font-light text-pitch-white mb-4 text-center">
        Dig Deeper Films
      </h1>
      <p class="font-body text-sm tracking-[0.2em] uppercase text-pitch-muted text-center mb-24">
        Selected Projects
      </p>

      <div class="space-y-16">
        {projects.map(project => (
          <a
            href={`/${project.slug}`}
            class="group block border-b border-pitch-dim pb-12 hover:border-pitch-white/30 transition-colors duration-500"
          >
            <div class="flex flex-col md:flex-row md:items-end justify-between gap-4">
              <div>
                <h2 class="font-display text-2xl md:text-4xl font-light text-pitch-white group-hover:text-pitch-white/80 transition-colors duration-300">
                  {project.title}
                </h2>
                <p class="font-body text-sm font-light text-pitch-muted mt-2">
                  {project.subtitle}
                </p>
              </div>
              <div class="flex items-center gap-6 shrink-0">
                <span class="font-body text-xs tracking-[0.2em] uppercase text-pitch-muted">
                  {project.format}
                </span>
                <span class="font-body text-xs tracking-wide text-pitch-dim">
                  {project.status}
                </span>
              </div>
            </div>
          </a>
        ))}
      </div>
    </div>
  </main>
</Layout>

<script>
  document.body.classList.remove('scroll-locked')
</script>
